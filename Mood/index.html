<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mood Diary</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
            padding: 20px;
        }
        input, button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>Mood Diary (Sepolia)</h1>
    <button onclick="connectWallet()">Connect Wallet</button>
    <p><strong>Connected Account:</strong> <span id="account">Not connected</span></p>
    
    <h2>Set Your Mood</h2>
    <input type="text" id="moodInput" placeholder="Enter your mood">
    <button onclick="setMood()">Set Mood</button>
    
    <h2>Current Mood</h2>
    <p id="moodDisplay">Click to fetch mood</p>
    <button onclick="getMood()">Get Mood</button>

    <script>
        const contractAddress = "0xD264fa43EB5F9c962f8712d4e30814544E3FaDa1";
        const contractABI = [
            { "inputs": [{ "internalType": "string", "name": "_mood", "type": "string" }], "name": "setMood", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            { "inputs": [], "name": "getMood", "outputs": [{ "internalType": "string", "name": "", "type": "string" }], "stateMutability": "view", "type": "function" }
        ];
        
        let web3;
        let contract;
        let userAccount;
        
        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                console.log("Ethereum successfully detected!");
                console.log("WEB3: ", web3);
                await window.ethereum.request({ method: "eth_requestAccounts" });
                const WEB3_ETH= await web3.eth;
                console.log("WEB3_ETH: ", WEB3_ETH);
                const accounts = await web3.eth.getAccounts();
                userAccount = accounts[0];
                document.getElementById("account").innerText = userAccount;
                contract = new web3.eth.Contract(contractABI, contractAddress);
            } else {
                alert("Please install MetaMask!");
            }
        }
        
        async function setMood() {
            const mood = document.getElementById("moodInput").value;
            if (!mood) return alert("Please enter a mood!");
            if (!contract) return alert("Connect wallet first!");
            
            try {
                await contract.methods.setMood(mood).send({ from: userAccount });
                alert("Mood set successfully!");
            } catch (error) {
                console.error(error);
                alert("Error setting mood!");
            }
        }
        
        async function getMood() {
            if (!contract) return alert("Connect wallet first!");
            
            try {
                const mood = await contract.methods.getMood().call();
                document.getElementById("moodDisplay").innerText = mood || "No mood set yet";
            } catch (error) {
                console.error(error);
                alert("Error fetching mood!");
            }
        }
    </script>
</body>
</html>
